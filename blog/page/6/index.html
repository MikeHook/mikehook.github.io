
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>baking websites</title>
	<meta name="author" content="Mike Hook">

	
	<meta name="description" content="Aug 29th, 2011 Hacking Comments Nhibernate Generator Class for SQLite Databases I&rsquo;ve been developing a mobile app for Android which needs to &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="baking websites" type="application/atom+xml">
	
	<link rel="canonical" href="http://bakingwebsites.co.uk/blog/page/6/">
	<link href="http://bakingwebsites.co.uk/favicon.png" rel="shortcut icon">
	<link href="http://bakingwebsites.co.uk/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="http://bakingwebsites.co.uk/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> 
-->
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-47738964-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<img src="/images/bread-Sq-zoom-150.jpg" alt="Profile Picture" style="width: 160px;" />
</div>
<hgroup>
  <h1><a href="http://bakingwebsites.co.uk/">baking websites</a></h1>
  
    <h2>adventures in software development</h2>
  
</hgroup>

<nav id="main-nav"><h3>categories</h3>
<ul class="main-navigation">
<li class='category'><a href='/blog/categories/hacking/'>Hacking</a>[ 22 ]</li>
<li class='category'><a href='/blog/categories/progress/'>Progress</a>[ 5 ]</li>
<li class='category'><a href='/blog/categories/software-design/'>Software Design</a>[ 15 ]</li>
<li class='category'><a href='/blog/categories/testing/'>Testing</a>[ 2 ]</li>
<li class='category'><a href='/blog/categories/tips-and-tricks/'>Tips and Tricks</a>[ 9 ]</li>

</ul>
<br/>
<a href="http://bakingwebsites.co.uk/blog/archives">Archives</a>


</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
			<a class="twitter" href="http://twitter.com/michael_hook" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/MikeHook" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-08-29T15:40:26+01:00" data-updated="true" itemprop="datePublished">Aug 29<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='http://bakingwebsites.co.uk/blog/categories/hacking/'>Hacking</a>


</div>
		
			<span class="comments"><a href="http://bakingwebsites.co.uk/2011/08/29/nhibernate-generator-class-for-sqlite-databases/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="http://bakingwebsites.co.uk/2011/08/29/nhibernate-generator-class-for-sqlite-databases/" itemprop="url">Nhibernate Generator Class for SQLite Databases</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I&rsquo;ve been developing a mobile app for Android which needs to query data in an SQLite database. So the first task I needed to get done was to import data into the SQLite database. As I&rsquo;m more used to writing .NET applications which use the NHibernate ORM I decided to write an import program on this technology stack.</p>

<p>For my first attempt at the import program I just wanted to focus on the import logic, so choose to use a &lsquo;known working&rsquo; NHibernate configuration with a MS SQL 2005 database. While this worked fine for me it did mean that I had to manually copy all of the data from the MS SQL database into the SQLite database before it could be used in the Android app. This was quite laborious so when I needed to modify the importer at a later date I decided to change the NHibernate configuration to point directly to the SQLite database instead. This was the updated config file used:</p>

<pre style="font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;color:#000000;background-color:#eee;font-size:12px;border:1px dashed #999999;line-height:14px;overflow:auto;width:100%;padding:5px;">&lt;hibernate-configuration  xmlns="urn:nhibernate-configuration-2.2" &gt;
    &lt;session-factory&gt;
        &lt;property name="connection.provider"&gt;NHibernate.Connection.DriverConnectionProvider&lt;/property&gt;
        &lt;property name="connection.driver_class"&gt;NHibernate.Driver.SQLiteDriver&lt;/property&gt;
        &lt;property name="connection.connection_string_name"&gt;FootyLinks&lt;/property&gt;
        &lt;property name="dialect"&gt;NHibernate.Dialect.SQLiteDialect&lt;/property&gt;
        &lt;property name="query.substitutions"&gt;true=1;false=0&lt;/property&gt;
    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;</pre>


<p>And this is an example of the connection string format:</p>

<pre style="font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;color:#000000;background-color:#eee;font-size:12px;border:1px dashed #999999;line-height:14px;overflow:auto;width:100%;padding:5px;">&lt;configuration&gt;
    &lt;connectionStrings&gt;
        &lt;add name="FootyLinks" connectionString="Data Source=C:\path_to_the_SQLite_database_file;Version=3"/&gt;
    &lt;/connectionStrings&gt;
&lt;/configuration&gt;</pre>


<p>This configuration worked OK and the import program could connect to the SQLite database, however I hit a problem when trying to save new records to the database. This was the inner exception reported by NHibernate:</p>

<blockquote>Abort due to constraint violation Club.Id may not be NULL</blockquote>


<p>The problem was that the import program was using the default generator class of <em>identity  </em>for in the NHibernate entity mappings. So NHibernate was expecting the database to generate the identity keys for the new records being saved to the database, however SQLite does not appear to support this. After some reading up on the options available for the <a href="http://nhforge.org/doc/nh/en/index.html#mapping-declaration-id-generator">NHibernate generator setting</a>  I decided to try the  <em>native  </em>setting. As this should select the implementation supported by the database. However this didn&rsquo;t work either, I think because, of all the options <em>native</em> can select, none are actually supported by SQLite. So my next preferred selection was to use <em>increment,</em>  this setting comes with a disclaimer that it should not be used in a cluster, which is absolutely fine as its very unlikely that I will ever be deploy the importer to a load balanced environment.</p>

<p>The <em>increment</em> setting worked fine with the SQLite database and should streamline my workflow nicely for updating the app data .</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-07-17T17:29:21+01:00" data-updated="true" itemprop="datePublished">Jul 17<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='http://bakingwebsites.co.uk/blog/categories/hacking/'>Hacking</a>


</div>
		
			<span class="comments"><a href="http://bakingwebsites.co.uk/2011/07/17/footylinks-roadmap/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="http://bakingwebsites.co.uk/2011/07/17/footylinks-roadmap/" itemprop="url">FootyLinks Roadmap</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<ol>
    <li>Make lowest difficulty level easier (squad numbers?, exclude older players?)</li>
    <li>Correct answer page</li>
    <li>Display score in game</li>
    <li>Increment score on correct answer</li>
    <li>Fix occasional crashing on view changes (db init to game startup event?)</li>
    <li>Only allow user to select roles available at their level</li>
    <li>Release one</li>
    <li>Level up on score thresholds</li>
    <li>Change game rules depending on difficulty level</li>
    <li>Post scores to twitter</li>
    <li>Update data with latest transfers</li>
    <li>Release two</li>
</ol>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-03-10T16:39:43+00:00" data-updated="true" itemprop="datePublished">Mar 10<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='http://bakingwebsites.co.uk/blog/categories/tips-and-tricks/'>Tips and Tricks</a>


</div>
		
			<span class="comments"><a href="http://bakingwebsites.co.uk/2011/03/10/android-dev-tip-fix-the-eclipse-auto-complete/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="http://bakingwebsites.co.uk/2011/03/10/android-dev-tip-fix-the-eclipse-auto-complete/" itemprop="url">Android Dev Tip - Fix the Eclipse Auto-complete</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I recently had problems with the eclipse IDE auto-complete not working.</p>

<p>After Googling the problem, I managed to resolve this by downloading the source for the version I was using and extracting into the Android SDK folder, as detailed in <a href="http://code.google.com/p/android/issues/detail?id=7850#c8">this google code issue</a>.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-02-23T19:48:46+00:00" data-updated="true" itemprop="datePublished">Feb 23<span>rd</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='http://bakingwebsites.co.uk/blog/categories/hacking/'>Hacking</a>


</div>
		
			<span class="comments"><a href="http://bakingwebsites.co.uk/2011/02/23/developing-android-apps-part-1-setting-up-your-machine/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="http://bakingwebsites.co.uk/2011/02/23/developing-android-apps-part-1-setting-up-your-machine/" itemprop="url">Developing Android Apps - Part 1: Setting Up Your Machine</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>This is the first in a series of posts I&rsquo;ll be making about developing Android applications. Hopefully there will be some useful tips in this series that will help other developers to get their apps off the ground.</p>

<p>The first step is to get your PC setup with all the required software for writing the apps. There is a pretty good guide <a href="http://developer.android.com/sdk/index.html">setting up the Android SDK</a> on the Android developer site so I won&rsquo;t go into too much detail. However, I think their steps are in the wrong order so I&rsquo;ve amended them below (you should install the Android platforms before the ADT plugin):</p>

<ol>
    <li>Prepare your development computer and ensure it meets the system requirements.
<ul>
    <li>You need to install the Java Development kit here, if you just run their SDK installer it provides a link to the JDK.</li>
</ul>
</li>
    <li>Install the SDK starter package from the table above. (If you&#8217;re on Windows, download the installer for help with the initial setup.)</li>
    <li>Add Android platforms and other components to your SDK.
<ul>
    <li>I only added the 2 latest SDK platforms along with their samples, I doubt you would need the older ones unless you have to develop for some legacy device.</li>
</ul>
</li>
    <li>If you don&#8217;t already have it,  <a href="http://www.eclipse.org/downloads/">download Eclipse</a> and install it
<ul>
    <li>While the platforms are downloading you can grab a copy of eclipse. It doesn&#8217;t need installing as such you can just extract to your hard drive.</li>
</ul>
</li>
    <li>Install the <a href="http://developer.android.com/sdk/eclipse-adt.html">ADT Plugin for Eclipse</a>.
<ul>
    <li>After Eclipse has extracted and your android platforms are added, you can hook the Android SDK into Eclipse by installing the ADT plugin.</li>
</ul>
</li>
    <li>Explore the contents of the Android SDK (optional).</li>
</ol>


<p>Once all the above are done you should be ready to start developing. A good place to start is with the <a href="http://developer.android.com/resources/tutorials/hello-world.html">hello world tutorial</a>, that takes you through setting up an Android virtual machine on    your computer and getting the application to run on it.</p>

<p>I also wanted to see an app actually running on my phone so followed the <a href="http://developer.android.com/guide/developing/device.html">developing on a device guide</a> to get this up and running. I did hit a snag here with the USB drivers, my phone is an HTC desire and there is no driver to download from the HTC site. However if you download the HTC sync software then plug your phone into the USB it should install the driver for you. I had to restart the phone afterwards before it would bring up the menu to select the connection type, eventually the sync software sorted itself out and recognised the phone.</p>

<p>When you select to run the application in Eclipse, your phone should then appear under the &lsquo;Choose a running Android device&rsquo; section. The app can be installed on the phone then selected from the usual apps menu.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2011-02-17T19:19:43+00:00" data-updated="true" itemprop="datePublished">Feb 17<span>th</span>, 2011</time></div>
		<div class="tags">


	<a class='category' href='http://bakingwebsites.co.uk/blog/categories/software-design/'>Software Design</a>


</div>
		
			<span class="comments"><a href="http://bakingwebsites.co.uk/2011/02/17/optimising-page-load-performance-with-database-files/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="http://bakingwebsites.co.uk/2011/02/17/optimising-page-load-performance-with-database-files/" itemprop="url">Optimising Page Load Performance With Database Files</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I recently ran into an issue with a newly released web application. The test version of the application was performing fine, however the live version kept reporting  time out  errors.
The page that was generating the time outs included a list of links to files stored in a database. After some investigation it became clear that the issue was being caused by the application loading all of these files into memory during the page load (yikes!).</p>

<p>It had worked fine on the test site because the bandwidth between the database and the website was a lot higher and also only a couple of small files had been stored. However the live site was hitting the HTTP request timeout (90 seconds by default) before all of the files had finished loading into memory. There was not actually any need for these files loaded at all during page load, so I set about re-factoring the domain structure to reflect this.</p>

<h3>Hurry up and be more lazy!</h3>


<p>The application uses NHibernate to map the domain objects to an SQL database, this is an example similar to the object that was causing the performance issue:</p>

<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:andale mono, lucida console, monaco, fixed, monospace;font-size:12px;height:100px;line-height:14px;overflow:auto;width:100%;padding:5px;"><code>public class StoredFile
{
    public virtual string Name { get; set; }
    public virtual string Extension { get; set; }
    public virtual bool Saved { get; set; }
    public virtual byte[] Contents { get; set; }
}
</code></pre>


<p>You can see here that the FileContents property is an array of bytes, which will be loaded into memory when the StoredFile object is initialised. However the only properties we need to access during the page load are the FileName, FileExtension and FileSaved properties.</p>

<p>If the FileContents property is moved to a separate object and then NHibernates <a href="http://martinfowler.com/eaaCatalog/lazyLoad.html">lazy loading</a> feature can be leveraged to only load that object if it is accessed. The revised domain structure looks like this:</p>

<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:andale mono, lucida console, monaco, fixed, monospace;font-size:12px;height:170px;line-height:14px;overflow:auto;width:100%;padding:5px;"><code>public class StoredFile
{
    public virtual string Name { get; set; }
    public virtual string Extension { get; set; }
    public virtual bool Saved { get; set; }
    public virtual StoredFileContents FileContents { get; set; }
}

public class StoredFileContents
{
    public virtual byte[] Contents { get; set; }
}
</code></pre>




<h3>NHibernate Mapping Issues</h3>


<p>You may have noticed that the StoredFileContents class above does not include a reference to the parent StoredFile object. Originally I had included this reference and attempted to map it following <a href="http://ayende.com/Blog/archive/2009/04/19/nhibernate-mapping-ltone-to-onegt.aspx">Ayende&rsquo;s one-to-one mapping blog post</a>. However I hit problems when trying to save, as each record needed to know the primary key of the other record. This was only workable if one of the foreign key tables was set to nullable. In this case, as I don&rsquo;t  foresee  there being a need to access a StoredFile from a StoredFileContents instance, I decided it was better to keep the foreign key as non nullable and only map the relationship in one direction.</p>

<p>In case you&rsquo;re wondering what effect the change had on the application, the  page load time was reduced to a couple of seconds (and even less on a decent connection), sorted!</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="http://bakingwebsites.co.uk/blog/page/5/" class="prev">Prev</a>
    
    
        <a href="http://bakingwebsites.co.uk/blog/page/7/" class="next">Next</a>
    
    <div class="center"><a href="http://bakingwebsites.co.uk/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2015 - Mike Hook -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
</footer>
			

<script type="text/javascript">
      var disqus_shortname = 'bakingwebsites';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
